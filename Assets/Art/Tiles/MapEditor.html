<!DOCTYPE html>
<html>
    <head>
        <title>tileset mapper</title>
        <meta charset="utf-8">
        <style>
#tilemap {
    width: calc(32px * 100);
    line-height: 0;
}

.tile {
    width: 32px;
    height: 32px;
    display: inline-block;
}
        </style>
    </head>
    <body>
        <label for="bgcolor">Background color:</label>
        <input type="text" id="bgcolor" name="bgcolor" value="#000" />
        <hr />
        <div id="tool"></div>
        <hr />
        <div id="tilemap"></div>
    </body>
    <script>
(function() {
    var WIDTH = 100;
    var HEIGHT = 30;
    var bgcolor = '#000';
    var currentIdx = 0;

    var tiles = [
        'World/Cobblestone.png',
        'World/Carpeted.png',
        'World/Wood.png',
		'Escher/ColumnEnd.png',
		'Escher/ColumnMiddle.png',
		'Escher/Floor.png',
		'Escher/StairsContinuation.png',
		'Escher/StairsStart.png',
		'Escher/ColumnBot.png',
		'Escher/ColumnBotLeft.png',
		'Escher/ColumnBotRight.png',
		'Escher/ColumnMiddleLeft.png',
		'Escher/ColumnMiddleRight.png',
		'Escher/ColumnEndLeft.png',
		'Escher/ColumnEndRight.png',
		'Escher/FloorLeft.png',
		'Paintbrush.png',
		'PaintbrushRight.png',
		'PaintbrushLeft.png',
		'PaintbrushBot.png',
		'Escher/StairsMiddle.png',
		'Escher/StairsBottom.png',
		'Escher/StairsCorner.png',
		'Escher/StairsRight.png',
		'Escher/StairsOther.png',
		'Escher/StairsFinal.png',
		'Escher/BowlOfFruit.png',
		'Escher/Door.png',
		'Escher/Portal.png'
    ];

    var el = document.getElementById('tilemap');

    function updateTile(tile) {
        var i = parseInt(tile.dataset.idx, 10);

        tile.style.background = i == 0
            ? bgcolor
            : 'url(' + tiles[i - 1] + ')';
    }

    function updateTileIdx(tile) {
        return function() {
            tile.dataset.idx = currentIdx;
            updateTile(tile);
        };
    }

    function renderTile() {
        var tile = document.createElement('div');

        tile.className = 'tile';
        tile.dataset.idx = 0;

        tile.addEventListener('click', updateTileIdx(tile));
        tile.addEventListener('mousedown', updateTileIdx(tile));

        updateTile(tile);
        return tile;
    }

    function renderTool() {
        var tool = document.getElementById('tool');

        var currentTile = renderTile();
        currentTile.id = 'currentTile';

        tool.appendChild(currentTile);

        var palette = document.createElement('div');
        palette.id = 'palette';

        tool.appendChild(palette);

        for (var i = 0; i < tiles.length + 1; ++i) {
            var paletteTile = renderTile().cloneNode(true);

            paletteTile.dataset.idx = i;

            paletteTile.addEventListener('dragstart', function(ev) {
                ev.preventDefault();
            });

            paletteTile.addEventListener('click', function(ev) {
                var idx = parseInt(ev.target.dataset.idx, 10);
                
                currentTile.dataset.idx = idx;
                currentIdx = idx;

                updateTile(currentTile);
            });

            updateTile(paletteTile);

            palette.appendChild(paletteTile);
        }
    }

    renderTool();
    for (var i = 0; i < WIDTH * HEIGHT; ++i) {
        el.appendChild(renderTile());
    }

    document.getElementById('bgcolor').addEventListener('change', function(ev) {
        bgcolor = ev.target.value;

        var tiles = document.querySelectorAll('.tile');
        Array.prototype.slice.call(tiles, 0).forEach(function(tile) {
            if (tile.dataset.idx === '0') {
                tile.style.background = bgcolor;
            }
        });
    });
})();
    </script>
</html>
